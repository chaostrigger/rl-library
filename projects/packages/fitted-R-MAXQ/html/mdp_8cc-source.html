<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Fitted R-MAXQ: mdp.cc Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li><a href="dirs.html"><span>Directories</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<div class="nav">
<a class="el" href="dir_f7364f79d8ff301e2fa7be00dc334ae9.html">Agent</a></div>
<h1>mdp.cc</h1><a href="mdp_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include "<a class="code" href="mdp_8hh.html">mdp.hh</a>"</span>
<a name="l00002"></a>00002 
<a name="l00003"></a><a class="code" href="classMDPStateAction.html#4b21823efc82cec49b8ec2dfd4d1a897">00003</a> <a class="code" href="classMDPStateAction.html#4b21823efc82cec49b8ec2dfd4d1a897">MDPStateAction::~MDPStateAction</a>()
<a name="l00004"></a>00004 {}
<a name="l00005"></a>00005 
<a name="l00006"></a><a class="code" href="classMDPState_1_1Observer.html#f2770420b7af3fab55937c370de801ee">00006</a> <a class="code" href="classMDPState_1_1Observer.html#f2770420b7af3fab55937c370de801ee">MDPState::Observer::~Observer</a>()
<a name="l00007"></a>00007 {}
<a name="l00008"></a>00008 
<a name="l00009"></a><a class="code" href="classMDPState.html#707b5440cc3fe566f3be74917ae4c334">00009</a> <a class="code" href="classMDPState.html#707b5440cc3fe566f3be74917ae4c334">MDPState::~MDPState</a>()
<a name="l00010"></a>00010 {}
<a name="l00011"></a>00011 
<a name="l00012"></a><a class="code" href="classMDPState.html#a018183b2617c0d310c4a7d2c2249fbb">00012</a> <span class="keywordtype">void</span> <a class="code" href="classMDPState.html#a018183b2617c0d310c4a7d2c2249fbb">MDPState::add_observer</a>(<span class="keyword">const</span> ObserverWeakRef &amp;o)
<a name="l00013"></a>00013 {
<a name="l00014"></a>00014   <a class="code" href="state_8hh.html#957cfad281ddead68bd4b635b4c0d91a">vector_set_insert</a>(<a class="code" href="classMDPState.html#077f81b3514328770dce1838d00e7c2f">m_observers</a>, o);
<a name="l00015"></a>00015 }
<a name="l00016"></a>00016 
<a name="l00017"></a><a class="code" href="classMDPState.html#476905fb8018dcfc85a23ee59d05a457">00017</a> <span class="keywordtype">void</span> <a class="code" href="classMDPState.html#476905fb8018dcfc85a23ee59d05a457">MDPState::remove_observer</a>(<span class="keyword">const</span> ObserverWeakRef &amp;o)
<a name="l00018"></a>00018 {
<a name="l00019"></a>00019   <a class="code" href="state_8hh.html#61c89ca8ced5517015eec607fec668c8">vector_set_erase</a>(<a class="code" href="classMDPState.html#077f81b3514328770dce1838d00e7c2f">m_observers</a>, o);
<a name="l00020"></a>00020 }
<a name="l00021"></a>00021 
<a name="l00022"></a><a class="code" href="classMDPState.html#78f2ae0e71e240d1897038359a82b571">00022</a> <span class="keywordtype">void</span> <a class="code" href="classMDPState.html#78f2ae0e71e240d1897038359a82b571">MDPState::notify_MDP_observers</a>(<span class="keyword">const</span> <a class="code" href="action_8hh.html#ebbdc64dd0e954309f7d84b47a9734ff">TaskRef</a> &amp;a)
<a name="l00023"></a>00023 {
<a name="l00024"></a>00024   std::vector&lt;ObserverWeakRef&gt;::iterator i;
<a name="l00025"></a>00025   <span class="keywordflow">for</span> (i = <a class="code" href="classMDPState.html#077f81b3514328770dce1838d00e7c2f">m_observers</a>.begin(); i != <a class="code" href="classMDPState.html#077f81b3514328770dce1838d00e7c2f">m_observers</a>.end(); ++i)
<a name="l00026"></a>00026     i-&gt;lock()-&gt;observe_MDP_change(a);
<a name="l00027"></a>00027 }
<a name="l00028"></a>00028 
<a name="l00029"></a><a class="code" href="classMDP.html#666935b550c3f051429b4dd5dc72fc77">00029</a> <a class="code" href="classMDP.html#666935b550c3f051429b4dd5dc72fc77">MDP::~MDP</a>()
<a name="l00030"></a>00030 {}
<a name="l00031"></a>00031 
<a name="l00032"></a><a class="code" href="classMDP.html#67ad974cda204b85bb7b5dcc37c2a48b">00032</a> <a class="code" href="mdp_8hh.html#571644572b98c524f1a5bf9db2c62dcd">MDPStateRef</a> <a class="code" href="classMDP.html#67ad974cda204b85bb7b5dcc37c2a48b">MDP::state_data</a>(<span class="keyword">const</span> <a class="code" href="state_8hh.html#4b1eec1dbb253fd12007b9f7bb90ce93">StateVectorRef</a> &amp;s)
<a name="l00033"></a>00033 {
<a name="l00034"></a>00034   <a class="code" href="averager_8hh.html#eb852172e15caa33a6e213056c09dc06">AverageRef</a> average = <a class="code" href="classMDP.html#3ba83d3997a9c344d4d74c86144aa185">m_averager</a>-&gt;approximate(s);
<a name="l00035"></a>00035   <a class="code" href="classMDP.html#2da0d07e3f76a1a9f291f9978e26f8d4">StateWeakRef</a> &amp;data = <a class="code" href="classMDP.html#9219613dd947423e19fe2882ae55eb32">m_state_map</a>[average-&gt;state()];
<a name="l00036"></a>00036   <span class="keywordflow">if</span> (data.expired())
<a name="l00037"></a>00037     <span class="keywordflow">return</span> <a class="code" href="classMDP_1_1State.html#fffe104b83454006d26f6d7b44c3d820">State::create</a>(<a class="code" href="classMDP.html#ac4a046c821dcf42853e373e874a1910">m_this</a>.lock(), average, data);
<a name="l00038"></a>00038   <span class="keywordflow">else</span>
<a name="l00039"></a>00039     <span class="keywordflow">return</span> data.lock();
<a name="l00040"></a>00040 }
<a name="l00041"></a>00041 
<a name="l00042"></a><a class="code" href="classMDP.html#eb1fda9dd3400d6010be2d81335b0c56">00042</a> <span class="keywordtype">void</span> <a class="code" href="classMDP.html#eb1fda9dd3400d6010be2d81335b0c56">MDP::propagate_changes</a>()
<a name="l00043"></a>00043 {
<a name="l00044"></a>00044   std::set&lt;State::ActionWeakRef&gt;::iterator i;
<a name="l00045"></a>00045   <span class="keywordflow">for</span> (i = <a class="code" href="classMDP.html#e5531d51ca51ab29881581475beed482">m_inbox</a>.begin(); i != <a class="code" href="classMDP.html#e5531d51ca51ab29881581475beed482">m_inbox</a>.end(); ++i)
<a name="l00046"></a>00046     <span class="keywordflow">if</span> (!i-&gt;expired())
<a name="l00047"></a>00047       i-&gt;lock()-&gt;compute_successors();
<a name="l00048"></a>00048   <a class="code" href="classMDP.html#e5531d51ca51ab29881581475beed482">m_inbox</a>.clear();
<a name="l00049"></a>00049 }
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <a class="code" href="classMDP_1_1State.html#0d606b65a58eb20121f9a7acdc201da1">MDP::State::ActionRef</a>
<a name="l00052"></a><a class="code" href="classMDP_1_1State_1_1Action.html#89cb48d836eedee3682caf9035f188e2">00052</a> <a class="code" href="classMDP_1_1State_1_1Action.html#89cb48d836eedee3682caf9035f188e2">MDP::State::Action::create</a>(<span class="keyword">const</span> StateWeakRef &amp;parent,
<a name="l00053"></a>00053                            <span class="keyword">const</span> <a class="code" href="action_8hh.html#ebbdc64dd0e954309f7d84b47a9734ff">TaskRef</a> &amp;action,
<a name="l00054"></a>00054                            <span class="keyword">const</span> <a class="code" href="action_8hh.html#c3ccf319df0159196b73a6f8cbd0e702">StateActionModelRef</a> &amp;model)
<a name="l00055"></a>00055 {
<a name="l00056"></a>00056   <a class="code" href="classMDP_1_1State.html#0d606b65a58eb20121f9a7acdc201da1">ActionRef</a> result(<span class="keyword">new</span> <a class="code" href="classMDP_1_1State_1_1Action.html#2feee4ad77fefec6d25915486b0dc9f3">Action</a>(parent, action, model));
<a name="l00057"></a>00057   result-&gt;m_this = result;
<a name="l00058"></a>00058   result-&gt;m_model-&gt;add_observer(result-&gt;m_this);
<a name="l00059"></a>00059   result-&gt;compute_successors();
<a name="l00060"></a>00060   <span class="keywordflow">return</span> result;
<a name="l00061"></a>00061 }
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 <a class="code" href="classMDP_1_1State_1_1Action.html#2feee4ad77fefec6d25915486b0dc9f3">MDP::State::Action::</a>
<a name="l00064"></a><a class="code" href="classMDP_1_1State_1_1Action.html#2feee4ad77fefec6d25915486b0dc9f3">00064</a> <a class="code" href="classMDP_1_1State_1_1Action.html#2feee4ad77fefec6d25915486b0dc9f3">Action</a>(<span class="keyword">const</span> <a class="code" href="classMDP.html#2da0d07e3f76a1a9f291f9978e26f8d4">StateWeakRef</a> &amp;parent,
<a name="l00065"></a>00065        <span class="keyword">const</span> <a class="code" href="action_8hh.html#ebbdc64dd0e954309f7d84b47a9734ff">TaskRef</a> &amp;action,
<a name="l00066"></a>00066        <span class="keyword">const</span> <a class="code" href="action_8hh.html#c3ccf319df0159196b73a6f8cbd0e702">StateActionModelRef</a> &amp;model):
<a name="l00067"></a>00067   m_parent(parent), m_action(action), m_model(model)
<a name="l00068"></a>00068 {}
<a name="l00069"></a>00069 
<a name="l00070"></a><a class="code" href="classMDP_1_1State_1_1Action.html#b5074bd3aa1cbc7a25907bc8abdc7182">00070</a> <a class="code" href="classMDP_1_1State_1_1Action.html#b5074bd3aa1cbc7a25907bc8abdc7182">MDP::State::Action::~Action</a>()
<a name="l00071"></a>00071 {
<a name="l00072"></a>00072   std::vector&lt;std::pair&lt;EffectRef, AverageRef&gt; &gt;::const_iterator i;
<a name="l00073"></a>00073   <span class="keywordflow">for</span> (i = <a class="code" href="classMDP_1_1State_1_1Action.html#d3540bcb49735f1258bc144675d45496">m_averages</a>.begin(); i != <a class="code" href="classMDP_1_1State_1_1Action.html#d3540bcb49735f1258bc144675d45496">m_averages</a>.end(); ++i) {
<a name="l00074"></a>00074     <span class="keyword">const</span> <a class="code" href="averager_8hh.html#eb852172e15caa33a6e213056c09dc06">AverageRef</a> &amp;avg = i-&gt;second;
<a name="l00075"></a>00075     if (avg)
<a name="l00076"></a>00076       avg-&gt;remove_observer(<a class="code" href="classMDP_1_1State_1_1Action.html#522a4e58e90ac9924584b5d217030423">m_this</a>);
<a name="l00077"></a>00077   }
<a name="l00078"></a>00078   <a class="code" href="classMDP_1_1State_1_1Action.html#366899ca3b927a1c55f2f9ddf08188e5">m_model</a>-&gt;remove_observer(<a class="code" href="classMDP_1_1State_1_1Action.html#522a4e58e90ac9924584b5d217030423">m_this</a>);
<a name="l00079"></a>00079 }
<a name="l00080"></a>00080 
<a name="l00081"></a><a class="code" href="classMDP_1_1State_1_1Action.html#f0ebbd01bd043f3eeebf437b169dc4f6">00081</a> <span class="keywordtype">double</span> <a class="code" href="classMDP_1_1State_1_1Action.html#f0ebbd01bd043f3eeebf437b169dc4f6">MDP::State::Action::reward</a>()<span class="keyword"> const</span>
<a name="l00082"></a>00082 <span class="keyword"></span>{
<a name="l00083"></a>00083   <span class="keywordflow">return</span> <a class="code" href="classMDP_1_1State_1_1Action.html#366899ca3b927a1c55f2f9ddf08188e5">m_model</a>-&gt;reward();
<a name="l00084"></a>00084 }
<a name="l00085"></a>00085 
<a name="l00086"></a><a class="code" href="classMDP_1_1State_1_1Action.html#e771fd701f91678ec835776bcd0ac9bd">00086</a> <span class="keyword">const</span> <a class="code" href="state_8hh.html#777ffb0dbcbdd850c65f7ca814f87824">StateDistribution</a> &amp;<a class="code" href="classMDP_1_1State_1_1Action.html#e771fd701f91678ec835776bcd0ac9bd">MDP::State::Action::successor_probabilities</a>()<span class="keyword"> const</span>
<a name="l00087"></a>00087 <span class="keyword"></span>{
<a name="l00088"></a>00088   <span class="keywordflow">return</span> <a class="code" href="classMDP_1_1State_1_1Action.html#f5752f568aa214b6b01635890bede5a3">m_succs</a>;
<a name="l00089"></a>00089 }
<a name="l00090"></a>00090 
<a name="l00091"></a><a class="code" href="classMDP_1_1State_1_1Action.html#b67a1402c22d86bcc8fb1ec98d76743e">00091</a> <span class="keywordtype">void</span> <a class="code" href="classMDP_1_1State_1_1Action.html#b67a1402c22d86bcc8fb1ec98d76743e">MDP::State::Action::observe_model_change</a>()
<a name="l00092"></a>00092 {
<a name="l00093"></a>00093   <a class="code" href="classMDP_1_1State_1_1Action.html#f5e8474a47f7e07da2371fe15838aa32">m_parent</a>.lock()-&gt;m_mdp-&gt;m_inbox.insert(<a class="code" href="classMDP_1_1State_1_1Action.html#522a4e58e90ac9924584b5d217030423">m_this</a>);
<a name="l00094"></a>00094 }
<a name="l00095"></a>00095 
<a name="l00096"></a><a class="code" href="classMDP_1_1State_1_1Action.html#214004a0028c11d3b47e757265493b57">00096</a> <span class="keywordtype">void</span> <a class="code" href="classMDP_1_1State_1_1Action.html#214004a0028c11d3b47e757265493b57">MDP::State::Action::observe_average_change</a>()
<a name="l00097"></a>00097 {
<a name="l00098"></a>00098   <a class="code" href="classMDP_1_1State_1_1Action.html#f5e8474a47f7e07da2371fe15838aa32">m_parent</a>.lock()-&gt;m_mdp-&gt;m_inbox.insert(<a class="code" href="classMDP_1_1State_1_1Action.html#522a4e58e90ac9924584b5d217030423">m_this</a>);
<a name="l00099"></a>00099 }
<a name="l00100"></a>00100 
<a name="l00101"></a><a class="code" href="classMDP_1_1State_1_1Action.html#f4caf72f86d3ad4709d1c7f3c257ad12">00101</a> <span class="keywordtype">void</span> <a class="code" href="classMDP_1_1State_1_1Action.html#f4caf72f86d3ad4709d1c7f3c257ad12">MDP::State::Action::compute_successors</a>()
<a name="l00102"></a>00102 {
<a name="l00103"></a>00103   <a class="code" href="classMDP.html#9d901209b5626291a28f138037f07462">StateRef</a> parent(<a class="code" href="classMDP_1_1State_1_1Action.html#f5e8474a47f7e07da2371fe15838aa32">m_parent</a>);
<a name="l00104"></a>00104   <span class="keyword">const</span> <a class="code" href="state_8hh.html#4b1eec1dbb253fd12007b9f7bb90ce93">StateVectorRef</a> &amp;s = parent-&gt;state();
<a name="l00105"></a>00105   assert(parent);
<a name="l00106"></a>00106   <a class="code" href="classMDP_1_1State_1_1Action.html#f5752f568aa214b6b01635890bede5a3">m_succs</a>.clear(); <span class="comment">// This is what we're recomputing.</span>
<a name="l00107"></a>00107   <span class="comment">// Compare model's given effects against saved effect-&gt;average mapping</span>
<a name="l00108"></a>00108   <span class="keyword">const</span> <a class="code" href="action_8hh.html#626c25d58262ddb00339679776c6b8d9">EffectDistribution</a> &amp;effects = <a class="code" href="classMDP_1_1State_1_1Action.html#366899ca3b927a1c55f2f9ddf08188e5">m_model</a>-&gt;effects();
<a name="l00109"></a>00109   EffectDistribution::const_iterator a = effects.begin();
<a name="l00110"></a>00110   std::vector&lt;std::pair&lt;EffectRef, AverageRef&gt; &gt;::iterator b =
<a name="l00111"></a>00111     <a class="code" href="classMDP_1_1State_1_1Action.html#d3540bcb49735f1258bc144675d45496">m_averages</a>.begin();
<a name="l00112"></a>00112   <span class="keywordflow">while</span> (a != effects.end()) {
<a name="l00113"></a>00113     <span class="keywordflow">while</span> (b != <a class="code" href="classMDP_1_1State_1_1Action.html#d3540bcb49735f1258bc144675d45496">m_averages</a>.end() &amp;&amp; b-&gt;first &lt; a-&gt;first) {
<a name="l00114"></a>00114       <a class="code" href="averager_8hh.html#eb852172e15caa33a6e213056c09dc06">AverageRef</a> &amp;avg = b-&gt;second;
<a name="l00115"></a>00115       if (avg)
<a name="l00116"></a>00116         avg-&gt;remove_observer(<a class="code" href="classMDP_1_1State_1_1Action.html#522a4e58e90ac9924584b5d217030423">m_this</a>); <span class="comment">// remove erstwhile averages</span>
<a name="l00117"></a>00117       b = <a class="code" href="classMDP_1_1State_1_1Action.html#d3540bcb49735f1258bc144675d45496">m_averages</a>.erase(b);
<a name="l00118"></a>00118     }
<a name="l00119"></a>00119     <span class="keywordflow">if</span> (b == <a class="code" href="classMDP_1_1State_1_1Action.html#d3540bcb49735f1258bc144675d45496">m_averages</a>.end() || a-&gt;first &lt; b-&gt;first) { <span class="comment">// add a new average</span>
<a name="l00120"></a>00120       <span class="keyword">const</span> <a class="code" href="action_8hh.html#6db387a1b7176f31921d6c6d33cac115">EffectRef</a> &amp;effect = a-&gt;first;
<a name="l00121"></a>00121       <a class="code" href="state_8hh.html#4b1eec1dbb253fd12007b9f7bb90ce93">StateVectorRef</a> successor = effect-&gt;apply(s);
<a name="l00122"></a>00122       <a class="code" href="averager_8hh.html#eb852172e15caa33a6e213056c09dc06">AverageRef</a> succavg;
<a name="l00123"></a>00123       <span class="keywordflow">if</span> (*successor != *s) {
<a name="l00124"></a>00124         <span class="comment">// Not a self transition, so we approximate</span>
<a name="l00125"></a>00125         succavg = parent-&gt;m_mdp-&gt;m_averager-&gt;approximate(successor);
<a name="l00126"></a>00126         succavg-&gt;add_observer(<a class="code" href="classMDP_1_1State_1_1Action.html#522a4e58e90ac9924584b5d217030423">m_this</a>);
<a name="l00127"></a>00127       }
<a name="l00128"></a>00128       b = <a class="code" href="classMDP_1_1State_1_1Action.html#d3540bcb49735f1258bc144675d45496">m_averages</a>.insert(b, std::make_pair(a-&gt;first, succavg));
<a name="l00129"></a>00129     }
<a name="l00130"></a>00130     <span class="comment">// Add the translated successors for a-&gt;first == b-&gt;first</span>
<a name="l00131"></a>00131     <a class="code" href="averager_8hh.html#eb852172e15caa33a6e213056c09dc06">AverageRef</a> &amp;average = b-&gt;second;
<a name="l00132"></a>00132     <span class="keywordflow">if</span> (!average) {
<a name="l00133"></a>00133       <span class="comment">// Effect was a self-transition, so use parent's state_t ptr</span>
<a name="l00134"></a>00134       StateDistribution::iterator ins =
<a name="l00135"></a>00135         <a class="code" href="state_8hh.html#957cfad281ddead68bd4b635b4c0d91a">vector_set_insert</a>(<a class="code" href="classMDP_1_1State_1_1Action.html#f5752f568aa214b6b01635890bede5a3">m_succs</a>,
<a name="l00136"></a>00136                           std::make_pair(parent-&gt;state(), 0.0),
<a name="l00137"></a>00137                           <a class="code" href="structLessFirst.html">LessFirst&lt;StateDistribution::value_type&gt;</a>()).first;
<a name="l00138"></a>00138       ins-&gt;second += a-&gt;second;      
<a name="l00139"></a>00139     } <span class="keywordflow">else</span> { <span class="comment">// Usually, not a self-transition</span>
<a name="l00140"></a>00140       <span class="keyword">const</span> <a class="code" href="state_8hh.html#777ffb0dbcbdd850c65f7ca814f87824">StateDistribution</a> &amp;avg_succ = average-&gt;basis_weights();
<a name="l00141"></a>00141       StateDistribution::const_iterator i;
<a name="l00142"></a>00142       <span class="keywordflow">for</span> (i = avg_succ.begin(); i != avg_succ.end(); ++i) {
<a name="l00143"></a>00143         StateDistribution::iterator ins =
<a name="l00144"></a>00144           <a class="code" href="state_8hh.html#957cfad281ddead68bd4b635b4c0d91a">vector_set_insert</a>(<a class="code" href="classMDP_1_1State_1_1Action.html#f5752f568aa214b6b01635890bede5a3">m_succs</a>,
<a name="l00145"></a>00145                             std::make_pair(i-&gt;first, 0.0),
<a name="l00146"></a>00146                             <a class="code" href="structLessFirst.html">LessFirst&lt;StateDistribution::value_type&gt;</a>()).first;
<a name="l00147"></a>00147         ins-&gt;second += i-&gt;second * a-&gt;second; <span class="comment">// assumes norm == 1</span>
<a name="l00148"></a>00148       }
<a name="l00149"></a>00149     }
<a name="l00150"></a>00150     ++a;
<a name="l00151"></a>00151     ++b;
<a name="l00152"></a>00152   }
<a name="l00153"></a>00153   <span class="keywordflow">while</span> (b != <a class="code" href="classMDP_1_1State_1_1Action.html#d3540bcb49735f1258bc144675d45496">m_averages</a>.end()) { <span class="comment">// No longer in model, so delete</span>
<a name="l00154"></a>00154     <a class="code" href="averager_8hh.html#eb852172e15caa33a6e213056c09dc06">AverageRef</a> &amp;avg = b-&gt;second;
<a name="l00155"></a>00155     if (avg)
<a name="l00156"></a>00156       avg-&gt;remove_observer(<a class="code" href="classMDP_1_1State_1_1Action.html#522a4e58e90ac9924584b5d217030423">m_this</a>);
<a name="l00157"></a>00157     b = <a class="code" href="classMDP_1_1State_1_1Action.html#d3540bcb49735f1258bc144675d45496">m_averages</a>.erase(b);
<a name="l00158"></a>00158   }
<a name="l00159"></a>00159   parent-&gt;notify_MDP_observers(<a class="code" href="classMDP_1_1State_1_1Action.html#ea865cef388c370ff36915fccc235ffc">m_action</a>);
<a name="l00160"></a>00160 }
<a name="l00161"></a>00161 
<a name="l00162"></a><a class="code" href="classMDP_1_1State.html#fffe104b83454006d26f6d7b44c3d820">00162</a> <a class="code" href="classMDP.html#9d901209b5626291a28f138037f07462">MDP::StateRef</a> <a class="code" href="classMDP_1_1State.html#fffe104b83454006d26f6d7b44c3d820">MDP::State::create</a>(<span class="keyword">const</span> <a class="code" href="mdp_8hh.html#49363cdfff726ad26ffc3fdf31ce2a24">MDPRef</a> &amp;mdp,
<a name="l00163"></a>00163                                  <span class="keyword">const</span> <a class="code" href="averager_8hh.html#eb852172e15caa33a6e213056c09dc06">AverageRef</a> &amp;average,
<a name="l00164"></a>00164                                  <a class="code" href="classMDP.html#2da0d07e3f76a1a9f291f9978e26f8d4">StateWeakRef</a> &amp;ref)
<a name="l00165"></a>00165 {
<a name="l00166"></a>00166   <a class="code" href="classMDP.html#9d901209b5626291a28f138037f07462">StateRef</a> result(<span class="keyword">new</span> <a class="code" href="classMDP_1_1State.html#7122b54d1203dac6ea6860a8d5a8f816">State</a>(mdp, average));
<a name="l00167"></a>00167   ref = result-&gt;m_this = result;
<a name="l00168"></a>00168   <span class="keyword">const</span> <a class="code" href="state_8hh.html#4b1eec1dbb253fd12007b9f7bb90ce93">StateVectorRef</a> &amp;s = average-&gt;state();
<a name="l00169"></a>00169   std::vector&lt;TaskRef&gt;::const_iterator i;
<a name="l00170"></a>00170   <span class="keywordflow">for</span> (i = mdp-&gt;m_actions.begin(); i != mdp-&gt;m_actions.end(); ++i) {
<a name="l00171"></a>00171     <span class="keyword">const</span> <a class="code" href="action_8hh.html#ebbdc64dd0e954309f7d84b47a9734ff">TaskRef</a> &amp;a = *i;
<a name="l00172"></a>00172     <span class="keywordflow">if</span> (a-&gt;available(s)) {
<a name="l00173"></a>00173       <a class="code" href="action_8hh.html#c3ccf319df0159196b73a6f8cbd0e702">StateActionModelRef</a> model = a-&gt;model(s);
<a name="l00174"></a>00174       <a class="code" href="mdp_8hh.html#4d3be64e5964bd1d00793fc3ab8e1d13">MDPStateActionRef</a> sa = <a class="code" href="classMDP_1_1State_1_1Action.html#89cb48d836eedee3682caf9035f188e2">Action::create</a>(result, a, model);
<a name="l00175"></a>00175       <a class="code" href="state_8hh.html#15c4d35c4e99d1d90f35e4d7f3009539">vector_map_assoc</a>(result-&gt;m_state_action_map, a, sa);
<a name="l00176"></a>00176     }
<a name="l00177"></a>00177   }
<a name="l00178"></a>00178   <span class="keywordflow">return</span> result;
<a name="l00179"></a>00179 }
<a name="l00180"></a>00180 
<a name="l00181"></a><a class="code" href="classMDP_1_1State.html#7122b54d1203dac6ea6860a8d5a8f816">00181</a> <a class="code" href="classMDP_1_1State.html#7122b54d1203dac6ea6860a8d5a8f816">MDP::State::State</a>(<span class="keyword">const</span> <a class="code" href="mdp_8hh.html#49363cdfff726ad26ffc3fdf31ce2a24">MDPRef</a> &amp;mdp, <span class="keyword">const</span> <a class="code" href="averager_8hh.html#eb852172e15caa33a6e213056c09dc06">AverageRef</a> &amp;average):
<a name="l00182"></a>00182   m_mdp(mdp), m_average(average)
<a name="l00183"></a>00183 {
<a name="l00184"></a>00184 <span class="comment">//   std::cerr &lt;&lt; "MDP::State::State() with " &lt;&lt; mdp-&gt;m_actions.size()</span>
<a name="l00185"></a>00185 <span class="comment">//          &lt;&lt; " actions\n";</span>
<a name="l00186"></a>00186 }
<a name="l00187"></a>00187 
<a name="l00188"></a><a class="code" href="classMDP_1_1State.html#dcaeefa2b9f04be6effa50ddc58f4156">00188</a> <a class="code" href="classMDP_1_1State.html#dcaeefa2b9f04be6effa50ddc58f4156">MDP::State::~State</a>()
<a name="l00189"></a>00189 {
<a name="l00190"></a>00190   <a class="code" href="classMDP_1_1State.html#350cfd9c32810802ae26f6fe35266f16">m_mdp</a>-&gt;m_state_map.erase(<a class="code" href="classMDP_1_1State.html#8bfc50b6aa6171380775684692d53793">m_average</a>-&gt;state());
<a name="l00191"></a>00191 }
<a name="l00192"></a>00192 
<a name="l00193"></a><a class="code" href="classMDP_1_1State.html#10917d36ec699084f8304c42c902d06d">00193</a> <span class="keyword">const</span> <a class="code" href="state_8hh.html#4b1eec1dbb253fd12007b9f7bb90ce93">StateVectorRef</a> &amp;<a class="code" href="classMDP_1_1State.html#10917d36ec699084f8304c42c902d06d">MDP::State::state</a>()<span class="keyword"> const</span>
<a name="l00194"></a>00194 <span class="keyword"></span>{
<a name="l00195"></a>00195   <span class="keywordflow">return</span> <a class="code" href="classMDP_1_1State.html#8bfc50b6aa6171380775684692d53793">m_average</a>-&gt;state();
<a name="l00196"></a>00196 }
<a name="l00197"></a>00197 
<a name="l00198"></a>00198 <span class="keyword">const</span> std::vector&lt;std::pair&lt;TaskRef, MDPStateActionRef&gt; &gt; &amp;
<a name="l00199"></a><a class="code" href="classMDP_1_1State.html#8a1de0557107697a080cd0f16612b1c1">00199</a> <a class="code" href="classMDP_1_1State.html#8a1de0557107697a080cd0f16612b1c1">MDP::State::state_actions</a>()<span class="keyword"> const</span>
<a name="l00200"></a>00200 <span class="keyword"></span>{
<a name="l00201"></a>00201   <span class="keywordflow">return</span> <a class="code" href="classMDP_1_1State.html#24df347f08717517270b39bd2d071a70">m_state_action_map</a>;
<a name="l00202"></a>00202 }
<a name="l00203"></a>00203 
<a name="l00204"></a><a class="code" href="classMDP_1_1State.html#3a6e7bf66ce1af8c112ae7c7a55a2bf6">00204</a> <span class="keywordtype">void</span> <a class="code" href="classMDP_1_1State.html#3a6e7bf66ce1af8c112ae7c7a55a2bf6">MDP::State::observe_average_change</a>()
<a name="l00205"></a>00205 {}
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Dec 1 14:50:56 2010 for Fitted R-MAXQ by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
